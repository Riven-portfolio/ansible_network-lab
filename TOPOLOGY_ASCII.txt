════════════════════════════════════════════════════════════════════════════════
                    Ansible Network Lab - 拓撲架構圖
════════════════════════════════════════════════════════════════════════════════

                          ☁️  Internet (外部網路)
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
            ┌───────▼──────┐               ┌───────▼──────┐
            │     ISP1     │               │     ISP2     │
            │  AS 65001    │               │  AS 65002    │
            │203.0.113.1   │               │198.51.100.1  │
            └───────┬──────┘               └───────┬──────┘
                    │                               │
                    │ eBGP                          │ eBGP
                    │                               │
════════════════════╪═══════════════════════════════╪════════════════════════════
                    │         總部 (HQ)             │
                    │                               │
            ┌───────▼──────┐               ┌───────▼──────┐
            │      R1      │◄─────HSRP────►│      R2      │
            │   (Active)   │   (Priority)  │  (Standby)   │
            │Priority: 110 │               │Priority: 100 │
            │203.0.113.2   │               │198.51.100.2  │
            └───────┬──────┘               └───────┬──────┘
                    │                               │
                    │ VLAN 99 (Transit)            │
                    │ 10.10.99.0/24                │
                    │                               │
                    └───────────┬───────────────────┘
                                │
                        ┌───────▼───────┐
                        │      SW1      │
                        │ Access Switch │
                        └───┬───┬───┬───┘
                            │   │   │
                ┌───────────┘   │   └───────────────┐
                │               │                   │
        ┌───────▼──────┐  ┌────▼─────┐  ┌──────────▼─────────┐
        │   VLAN 10    │  │ VLAN 20  │  │     VLAN 60        │
        │    (User)    │  │   (IT)   │  │      (Log)         │
        │10.10.10.0/24 │  │10.10.20.0│  │  10.10.60.0/24     │
        │ VIP: .254    │  │VIP: .254 │  │   VIP: .254        │
        └──────────────┘  └──────────┘  └────────────────────┘

                        ┌────────────────┐
                        │       R3       │
                        │   (DMZ/ABR)    │
                        │  100.64.1.1    │
                        │  172.16.10.1   │
                        └───┬────────┬───┘
                            │        │
                    ┌───────┘        └─────────┐
                    │                          │
            ┌───────▼──────┐          ┌────────▼────────┐
            │   VLAN 50    │          │  GRE Tunnel    │
            │    (DMZ)     │          │   Tunnel0      │
            │10.10.50.0/24 │          │ 172.16.10.0/30 │
            │  GW: .1      │          │  MD5 Auth      │
            └───────┬──────┘          └────────┬────────┘
                    │                          │
            ┌───────▼──────┐                  │ Underlay
            │   WebSrv     │                  │ 100.64.1.0/30
            │ 10.10.50.10  │                  │
            │  (Web 伺服器) │                  │
            └──────────────┘                  │
                                              │
════════════════════════════════════════════════════════════════════════════════
                                              │      分公司 (Branch)
                                              │
                                      ┌───────▼──────┐
                                      │      BR1     │
                                      │Branch Router │
                                      │100.64.1.2    │
                                      │172.16.10.2   │
                                      └───────┬──────┘
                                              │
                                      ┌───────▼──────┐
                                      │    BR-SW     │
                                      │Branch Switch │
                                      └───────┬──────┘
                                              │
                                      ┌───────▼──────┐
                                      │  VLAN 110    │
                                      │ (Branch LAN) │
                                      │10.110.10.0/24│
                                      │  GW: .254    │
                                      └──────────────┘

════════════════════════════════════════════════════════════════════════════════
                              OSPF 區域架構
════════════════════════════════════════════════════════════════════════════════

    ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
    ┃                      OSPF Area 0 (Backbone)                      ┃
    ┃                                                                   ┃
    ┃         R1 ◄────► R2 ◄────► R3                                  ┃
    ┃                                                                   ┃
    ┃    Networks:                                                      ┃
    ┃      - 10.10.10.0/24 (VLAN 10)                                  ┃
    ┃      - 10.10.20.0/24 (VLAN 20)                                  ┃
    ┃      - 10.10.60.0/24 (VLAN 60)                                  ┃
    ┃      - 10.10.99.0/24 (VLAN 99)                                  ┃
    ┗━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                             │
                ┌────────────┴────────────┐
                │                         │
    ┏━━━━━━━━━▼━━━━━━━━━━━┓   ┏━━━━━━━━▼━━━━━━━━━━━━━━━━━━━━━━━━━┓
    ┃  OSPF Area 50       ┃   ┃      OSPF Area 10                 ┃
    ┃    (Stub)           ┃   ┃    (MD5 Authentication)           ┃
    ┃                     ┃   ┃                                    ┃
    ┃  R3 (ABR)          ┃   ┃  R3 (ABR) ◄────► BR1              ┃
    ┃    │                ┃   ┃                                    ┃
    ┃    └─► DMZ          ┃   ┃  Networks:                        ┃
    ┃   10.10.50.0/24    ┃   ┃    - 172.16.10.0/30 (Tunnel)     ┃
    ┃                     ┃   ┃    - 10.110.10.0/24 (Branch)     ┃
    ┃   WebSrv            ┃   ┃                                    ┃
    ┃   10.10.50.10       ┃   ┃  Summary: 10.110.0.0/16           ┃
    ┗━━━━━━━━━━━━━━━━━━━━━┛   ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

════════════════════════════════════════════════════════════════════════════════
                          Ansible 主機群組架構
════════════════════════════════════════════════════════════════════════════════

                        ┌─────────────────────┐
                        │  Ansible 控制節點   │
                        │   (Playbooks)       │
                        └──────────┬──────────┘
                                   │
                ┌──────────────────┼──────────────────┐
                │                  │                  │
        ┌───────▼──────┐   ┌──────▼──────┐   ┌──────▼──────┐
        │      hq      │   │   branch    │   │     isp     │
        └───────┬──────┘   └──────┬──────┘   └──────┬──────┘
                │                  │                  │
        ┌───────┴───────┐  ┌──────┴──────┐  ┌────────┴──────┐
        │               │  │             │  │                │
    ┌───▼────┐  ┌──────▼──┐  ┌──▼────┐ ┌▼───────┐  ┌──▼──┐ ┌▼───┐
    │hq_     │  │hq_      │  │branch_│ │branch_ │  │ISP1 │ │ISP2│
    │routers │  │switches │  │routers│ │switches│  │     │ │    │
    └───┬────┘  └────┬────┘  └───┬───┘ └────┬───┘  └─────┘ └────┘
        │            │           │          │
    ┌───┼────────┬───┤           │          │
    │   │        │   │           │          │
    R1  R2      R3  SW1         BR1       BR-SW

════════════════════════════════════════════════════════════════════════════════
                              設備統計資訊
════════════════════════════════════════════════════════════════════════════════

    總部 (HQ):         分公司 (Branch):      ISP:              伺服器:
    ├─ R1 (路由器)     ├─ BR1 (路由器)      ├─ ISP1          ├─ WebSrv
    ├─ R2 (路由器)     └─ BR-SW (交換機)    └─ ISP2
    ├─ R3 (路由器)
    └─ SW1 (交換機)

    總計: 10 台設備
    ├─ 路由器: 5 台 (R1, R2, R3, BR1, ISP1, ISP2)
    ├─ 交換機: 2 台 (SW1, BR-SW)
    ├─ 伺服器: 1 台 (WebSrv)
    └─ 管理節點: 1 台 (LogSrv - 可選)

════════════════════════════════════════════════════════════════════════════════
                            協定與功能總覽
════════════════════════════════════════════════════════════════════════════════

    ┌─────────────────────────────────────────────────────────────────┐
    │ Layer 2 (數據鏈路層)                                            │
    ├─────────────────────────────────────────────────────────────────┤
    │ • VLANs: 10, 20, 50, 60, 99, 110                              │
    │ • 802.1Q Trunk between R1/R2/R3 ◄─► SW1                      │
    │ • Access Ports for End Devices                                │
    └─────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │ Layer 3 (網路層)                                                │
    ├─────────────────────────────────────────────────────────────────┤
    │ • HSRP - Groups 10/20/60 (R1 Active, R2 Standby)            │
    │ • OSPF - Multi-Area (0, 10, 50) with MD5 Authentication      │
    │ • BGP - eBGP to ISP1/ISP2 (AS 65010 ◄─► 65001/65002)        │
    │ • GRE Tunnel - R3 ◄─► BR1 with MD5 Auth                     │
    │ • Static Routes - Default route via ISPs                     │
    └─────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │ Security (安全)                                                  │
    ├─────────────────────────────────────────────────────────────────┤
    │ • ACL - DMZ Protection on R3                                  │
    │ • NAT Overload - Internet access for internal networks       │
    │ • VLAN Segmentation - Network isolation                      │
    └─────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │ Management (管理)                                                │
    ├─────────────────────────────────────────────────────────────────┤
    │ • Syslog - Centralized logging (10.10.60.10)                │
    │ • NTP - Time synchronization                                  │
    │ • Ansible - Automated configuration management               │
    └─────────────────────────────────────────────────────────────────┘

════════════════════════════════════════════════════════════════════════════════
                              IP 地址規劃
════════════════════════════════════════════════════════════════════════════════

    HQ VLANs:
    ┌─────────┬──────────┬─────────────────┬──────────────┬─────────────┐
    │ VLAN ID │   名稱   │     網段        │    網關/VIP  │ HSRP Group  │
    ├─────────┼──────────┼─────────────────┼──────────────┼─────────────┤
    │   10    │   User   │ 10.10.10.0/24   │ 10.10.10.254 │     10      │
    │   20    │    IT    │ 10.10.20.0/24   │ 10.10.20.254 │     20      │
    │   50    │   DMZ    │ 10.10.50.0/24   │  10.10.50.1  │      -      │
    │   60    │   Log    │ 10.10.60.0/24   │ 10.10.60.254 │     60      │
    │   99    │ Transit  │ 10.10.99.0/24   │      -       │      -      │
    └─────────┴──────────┴─────────────────┴──────────────┴─────────────┘

    Branch VLANs:
    ┌─────────┬────────────┬─────────────────┬───────────────┐
    │ VLAN ID │    名稱    │     網段        │     網關      │
    ├─────────┼────────────┼─────────────────┼───────────────┤
    │  110    │ Branch-LAN │ 10.110.10.0/24  │ 10.110.10.254 │
    └─────────┴────────────┴─────────────────┴───────────────┘

    Point-to-Point Links:
    ┌───────────────┬───────────────────┬──────────────┬──────────────┐
    │     連接      │      網段         │  設備1 IP    │  設備2 IP    │
    ├───────────────┼───────────────────┼──────────────┼──────────────┤
    │  R1 ◄─► ISP1 │ 203.0.113.0/30    │ 203.0.113.2  │ 203.0.113.1  │
    │  R2 ◄─► ISP2 │ 198.51.100.0/30   │ 198.51.100.2 │ 198.51.100.1 │
    │ R3 ◄─► BR1   │ 100.64.1.0/30     │ 100.64.1.1   │ 100.64.1.2   │
    │ (Underlay)    │                   │              │              │
    │ R3 ◄─► BR1   │ 172.16.10.0/30    │ 172.16.10.1  │ 172.16.10.2  │
    │ (Tunnel)      │                   │              │              │
    └───────────────┴───────────────────┴──────────────┴──────────────┘

════════════════════════════════════════════════════════════════════════════════
                          High Availability (高可用性)
════════════════════════════════════════════════════════════════════════════════

    HSRP 容錯機制:

    正常狀態:                              故障切換:
    ┌─────────────┐                        ┌─────────────┐
    │     R1      │                        │     R1      │
    │  (Active)   │◄────HSRP Group────────►│   (Down)    │
    │Priority: 110│      10/20/60          │Priority: 110│
    │     ✓       │                        │      ✗      │
    └──────┬──────┘                        └─────────────┘
           │
           │ Traffic Flow
           ▼
      VIP x.x.x.254                          VIP x.x.x.254
           ▲                                       ▲
           │                                       │
    ┌──────┴──────┐                        ┌──────┴──────┐
    │     R2      │                        │     R2      │
    │ (Standby)   │                        │  (Active)   │
    │Priority: 100│                        │Priority: 100│
    │    待機     │                        │  ✓ 接管     │
    └─────────────┘                        └─────────────┘

    BGP 冗餘路由:

    ┌────────────────────────────────────────────────────────┐
    │         10.10.0.0/16 + 10.110.0.0/16                 │
    │              Internal Networks                         │
    └───────────────────┬──────────┬─────────────────────────┘
                        │          │
              ┌─────────┘          └─────────┐
              │                              │
        ┌─────▼─────┐                  ┌─────▼─────┐
        │    R1     │                  │    R2     │
        │  AS 65010 │                  │  AS 65010 │
        └─────┬─────┘                  └─────┬─────┘
              │                              │
              │ eBGP                         │ eBGP
              │                              │
        ┌─────▼─────┐                  ┌─────▼─────┐
        │   ISP1    │                  │   ISP2    │
        │  AS 65001 │                  │  AS 65002 │
        └─────┬─────┘                  └─────┬─────┘
              │                              │
              └──────────────┬───────────────┘
                             │
                        Internet ☁️

════════════════════════════════════════════════════════════════════════════════
                          Ansible 部署流程 (S0-S8)
════════════════════════════════════════════════════════════════════════════════

    S0          S1          S2          S3          S4
    準備     ───► HQ      ───► DMZ     ───► OSPF    ───► GRE
    與基線       VLAN &      & R3        聚合         Tunnel
                 HSRP

    S5          S6          S7          S8
    分公司   ───► eBGP    ───► NAT     ───► 可觀測性
    LAN          連接        & ACL        & 日誌

════════════════════════════════════════════════════════════════════════════════
